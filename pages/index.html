<!DOCTYPE html>
<html lang="en">

    <head>
        <title>VoiceLens</title>

        <!-- =====BOX ICONS===== -->
        <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
        <!-- =====BOX ICONS===== -->

    </head>

    <body>
    
        <h1>VoiceLens</h1>

        <a>Upload: </a>
        <input type="file" accept="audio/*" capture id="recorder" /><br><br>
        <a>Or Record</a>

        <a id="download"></a>
            <button onclick="RecButton()" id="stop" >Rec</button>
                <script>
                    const downloadLink = document.getElementById('download');
                    const stopButton = document.getElementById('stop');

                    const handleSuccess = function(stream) {
                        const options = {mimeType: 'audio/webm'};
                        const recordedChunks = [];
                        const mediaRecorder = new MediaRecorder(stream, options);

                        mediaRecorder.addEventListener('dataavailable', function(e) {
                            if (e.data.size > 0) recordedChunks.push(e.data);
                        });

                        mediaRecorder.addEventListener('stop', function() {
                            downloadLink.href = URL.createObjectURL(new Blob(recordedChunks));
                            downloadLink.download = 'UserVoice.wav';
                        });

                        stopButton.addEventListener('click', function() {
                            mediaRecorder.stop();
                        });

                        mediaRecorder.start();
                    }

                    function RecButton() {
                        
                        var elem = document.getElementById("stop");
                        if (elem.innerHTML == "Rec" ) {
                            navigator.mediaDevices.getUserMedia({ audio: true, video: false }).then(handleSuccess);
                            elem.innerHTML = "Stop";
                        }
                        else {
                            elem.innerHTML = "Rec"
                            document.getElementById("download").innerHTML = "Download";
                        };
                    }

                </script>

        <br><br>

        <input type="submit" value="Submit">   

        <p>Click the "Submit" button after: <br>
            1. Filled in your ID. <br>
            2. Finished recording. 
        </p>

    </body>

    

</html>